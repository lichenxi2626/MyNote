# Shell

***

## 第一章 Shell概述

- Shell是一个命令行解释器，也是一种编程语言，通过接收应用程序或用户命令，调用操作系统内核。



## 第二章 Shell解析器

- Linux中提供了多种Shell解析器，其中常用的有
  - /bin/sh
  - /bin/bash
- sh是开启了POSIX（可移植操作系统接口）标准的bash
- CentOS中默认的解析器为bash



## 第三章 Shell脚本入门

- 脚本有固定的的开头格式，用于指定脚本使用的解析器

  ```shell
  #!/bin/bash
  ```

- helloworld脚本的编写

  ```shell
  #!/bin/bash
  echo helloworld
  ```

- 脚本执行有多种方式

  1. 使用sh命令执行脚本

     ```shell
     #使用相对路径
     sh helloworld.sh
     #使用绝地路径
     sh /root/helloworld.sh
     ```

  2. 使用bash命令执行脚本

     ```shell
     #使用相对路径
     bash helloworld.sh
     #使用绝地路径
     bash /root/helloworld.sh
     ```

  3. 直接执行脚本（必须具有执行权限）

     ```shell
     #赋予用户执行权限
     chmod 777 helloworld.sh
     #使用相对路径,不能省略"./",若省略则必须在环境变量中配置脚本所在目录
     ./helloworld.sh
     #使用绝地路径
     /root/helloworld.sh
     ```

  4. 在脚本所在目录下使用"."执行脚本

     ```shell
     . helloworld.sh
     #该方式不同于前3种方式的是:该脚本中的声明的变量会继承为环境变量,在脚本结束调用后依然生效
     ```

     

## 第四章 Shell中的变量

### 4.1 系统变量

- 常见的系统变量

  - $HOME：当前用户家目录路径
  - $PWD：当前所处路径
  - $SHELL：SHELL解析器路径

- 查看当前Shell中的所有变量：使用set命令

  ```shell
  set
  ```



### 4.2 自定义变量

- 基本语法

  - 定义变量：[变量]=[值]

    ```shell
    A=5
    ```

  - 撤销变量：unset [变量]

    ```shell
    unset A
    ```

  - 声明静态变量：readonly [变量]=值

    ```shell
    readonly A=5
    #静态变量不能重新赋值且不能使用unset撤销
    ```

  - 提升变量为全局环境变量：export [变量]

    ```shell
    #某一Shell脚本中声明
    A=1
    export A
    #提升后其他脚本中也可以调用A
    ```

- 变量定义的规则

  1. 变量名由字母（区分大小写）、数字、下划线构成，不能以数字开头，环境变量建议使用大写
  2. **等号两侧不能有空格**
  3. bash中，变量的默认类型均为字符串类型，不能直接用于计算
  4. 变量值若包含空格，需要使用''或“”整体括起

- **变量使用的规则**：当变量作为赋值对象调用时，不使用$，当变量作为引用对象调用时，使用$

  ```shell
  sum=$[$1+$2]
  ```



### 4.3 特殊变量 $n

- 作用说明： $n（n为数字）

  - $0：表示该脚本名称
  - $1-$9：表示传入的第1-9个参数
  - ${10}-${n}：表示传入的第10-n个参数

- 举例

  ```shell
  #编写脚本
  #!/bin/bash
  echo "$0 $1 $2"
  #调用
  ./parameter.sh 111 222
  #输出
  ./parameter.sh 111 222
  ```

  

### 4.4 特殊变量 $#

- 作用说明

  - $#：表示所有输入参数的个数（多用于循环）

- 举例

  ```shell
  #编写脚本
  #!/bin/bash
  echo $#
  #调用
  ./parameter.sh 111 222 333
  #输出
  3
  ```

  

### 4.5 特殊变量 $* $@

- 作用说明

  - $*：表示命令行中的所有参数，且看作一个整体
  - $@：表示命令行中的所有参数，且看作一个个个体

- 举例：在增强for循环中

  - $*

    ```shell
    #编写脚本
    #!/bin/bash
    for i in "$*" #注意此处必须使用"",否则效果等同于$@
     do
      echo $i
     done
    #调用
    ./for.sh 111 222 333
    #输出
    111 222 333
    ```

  - $@

    ```shell
    #编写脚本
    #!/bin/bash
    for i in "$@" #此处双引号可有可无
     do
      echo $i
     done
    #调用
    ./for.sh 111 222 333
    #输出
    111 
    222 
    333
    ```



### 4.6 特殊变量 $?

- 作用说明：用于判断最后一次命令的返回值/返回状态
  - 当最后一次命令含有返回值时，$?可接收该返回值
  - 当最后一次命令没有返回值时，$?可用于判断该命令是否正确执行
    - 正确执行：$? = 0
    - 错误执行：$? != 0



## 第五章 运算符

### 5.1 $[运算式]

```shell
A=$[1+2]
#优先使用，简单明了
```

### 5.2 $((运算式))

```shell
B=$((2+3))
```

### 5.3 expr 运算式

- expr运算不同于前两种方式，该运算会直接对运算结果进行输出（同echo），因此不能用于对变量赋值
- expr运算式中需要使用``代替()的作用，同时乘法运算需要使用"\\*"，不能直接使用\*

```shell
expr 3 + 4
expr `3 + 4` \* 5
#尽量不用，语法反人类
```



## 第六章 条件判断

- 基本语法

  ```shell
  [ condition ]
  #注意条件判断式两侧必须有空格
  
  #条件判断式不为空即为true
  [ lcx ] [ atguigu ]
  #条件判断式为空即为false
  [] [  ]
  ```

- 常用的判断条件

  - 判断**整数**大小

    | 条件 | 说明     |
    | ---- | -------- |
    | -lt  | 小于     |
    | -le  | 小于等于 |
    | -gt  | 大于     |
    | -ge  | 大于等于 |
    | -eq  | 等于     |
    | -ne  | 不等于   |

    ```shell
    [ 1 -ge 2 ]
    ```

  - 判断文件权限

    | 条件 | 说明         |
    | ---- | ------------ |
    | -r   | 具有读权限   |
    | -w   | 具有写权限   |
    | -x   | 具有执行权限 |

    ```shell
    [ -r lcx.txt ]
    ```

  - 判断文件类型

    | 条件 | 说明                     |
    | ---- | ------------------------ |
    | -f   | 文件或目录存在，且为文件 |
    | -e   | 文件或目录存在           |
    | -d   | 文件或目录存在，且为目录 |

    ```shell
    [ -d home/atguigu ]
    ```

- 逻辑运算符

  - &&：短路与，同为ture则为true，前者为false则不执行后者
  - ||：短路或，有ture则为true，前者为true则不执行后者



## 第七章 流程控制

#### 7.1 if

- 基本语法

  ```shell
  #方式一
  if [ 条件判断式 ];then
  	程序
  fi
  
  #方式二(常用)
  if [ 条件判断式1 ] #if后有空格
  	then
  		程序1
  elif [ 条件表达式2 ]
  	then
  		程序2
  else
  		程序3
  fi
  ```

  

#### 7.2 case

- 基本语法

  ```shell
  case $[变量名] in
  "值1")
  	程序1
  	;;
  "值2")
  	程序2
  	;;
  *)
  	程序3
  	;;
  esac
  ```

- 说明

  - 双分号;;表示结束当前case命令序列，相当于java中的break
  - *)表示默认，相当于java中的default



#### 7.3 for

- for循环

  ```shell
  for ((初始化变量;循环条件;迭代条件))
  	do
  		程序
  	done
   
  #举例：1-100累加
  for ((i=0;i<=100;i++)) #for循环括号中的运算规则与java相同
  	do
  		sum=$[$sum+$i]
  	done
  echo $sum
  ```

- 增强for循环

  ```shell
  #类似于java中的增强for循环,取消了(),并使用in代替了:
  for $[变量名] in "值1" "值2" "值3"
  	do
   		循环体
  	done
  ```

  

#### 7.4 while

- while循环

  ```shell
  while [ 条件判断式 ]
  	do
   		循环体
   		迭代条件
  	done
   
  #举例：1-100累加
  i=0
  while [ $i -le 100 ] #while循环的条件判断式中只能使用Shell的比较方式
  	do
   		sum=$[$sum+$i]
   		i=$[$i+1]
  	done
  echo $sum
  ```



## 第八章 读取控制台输入

```shell
#基本语法
read [选项] [参数]
#选项
-p:指定读取时的提示符
-t:指定读取时等待的时间(秒),若未输入则脚本继续向下执行
#举例：10秒内输入姓名并赋值给变量name
read -t 10 -p "请在10秒内输入姓名" name
echo $name
```



## 第九章 函数

### 9.1 系统函数

- basename

  ```shell
  #基本语法
  basename [文件路径] [文件后缀]
  #功能:截去目录路径，仅获取文件名，若指定文件的后缀，则后缀也一并截去
  
  #举例1
  basename /home/atguigu/lcx.txt
  #输出
  lcx.txt
  
  #举例2
  basename /home/atguigu/lcx.txt .txt
  #输出
  lcx
  ```

- dirname

  ```shell
  #基本语法
  dirname [绝对/相对路径]
  #功能:截去文件名，获取目录部分
  
  #举例1:绝对路径
  dirname /home/atguigu/lcx.txt
  #输出
  /home/atguigu
  
  #举例2:相对路径
  dirname atguigu/lcx.txt
  #输出
  atguigu
  ```

  

### 9.2 自定义函数

- 方法的声明语法

  ```shell
  function [funname]()
  {
  	[Action]
  	return [xxx] #返回值可选
  }
  ```

- 说明

  - **必须在调用函数前先声明函数，因为shell脚本逐行运行，没有编译过程**
  - **函数的返回值只能使用$?接收，若没有显示的声明return，则以函数的最后一条命令的运行结果作为返回值**

- 举例

  ```shell
  #编写shell脚本读取两个输入的参数并计算和
  
  #!/bin/bash
  #声明函数
  function getSum()
  {
  	sum=$[$1+$2]
  	echo $sum
  }
  #读取传参
  read -p "请输入第一个参数" p1
  read -p "请输入第二个参数" p2
  #调用函数
  getSum p1 p2
  ```



## 第十章 Shell工具

### 10.1 cut

- 基本语法

  ```shell
  cut [选项] [文件]
  #cut命令不会修改原文档内容
  ```

- 选项列表

  | 选项 | 功能                                 |
  | ---- | ------------------------------------ |
  | -f   | 提取列号                             |
  | -d   | 指定分隔符（分隔符只能是单字节字符） |

- 实例

  ```shell
  cut -d " " -f  1 test.txt
  #使用" "切割,提取第1列的内容
  
  cut -d " " -f 2,3 test.txt
  #使用" "切割,提取第2、3列的内容
  
  cat test.txt | grep "lcx" | cut -d " " -f 1
  #先筛选包含"lcx"字符串的行,再使用" "分隔符切割,提取第1列内容
  ```

  

### 10.2 sed

- 基本语法

  ```shell
  sed [选项] [命令] [文件]
  #sed命令不会修改原文档的内容
  ```

- 选项

  | 选项 | 功能               |
  | ---- | ------------------ |
  | -e   | 使用指令列模式编辑 |

- 命令

  | 命令 | 功能         |
  | ---- | ------------ |
  | a    | 新增至下一行 |
  | d    | 删除         |
  | s    | 查找并替换   |

- 举例

  ```shell
  sed '2a 123456' sed.txt
  #在第二行下添加123456,原第三行后内容向下延后一行
  
  sed '/wo/d' sed.txt
  #删除包含"wo"的行
  
  sed 's/wo/ni/g' sed.txt
  #将所有的"wo"替换为"ni",其中g为表示全部替换
  
  sed -e '2d' -e 's/wo/ni/g' sed.txt
  #删除第二行内容,将所有的"wo"替换为"ni"
  ```



### 10.3 awk

- 基本语法

  ```shell
  awk [选项] 'pattern1{action1} pattern2{action2} ...' [文件]
  #pattern:表示匹配的内容
  #action:表示匹配后的命令
  
  #awk命令不修改原文件内容
  ```

- 选项列表

  | 选项 | 功能                             |
  | ---- | -------------------------------- |
  | -F   | 指定分隔符（分隔符可以是字符串） |
  | -v   | 赋值一个用户定义的变量           |

- awk中的内置变量

  | 变量      | 说明                           |
  | --------- | ------------------------------ |
  | $FILENAME | 文件名                         |
  | $NR       | 已读记录数（筛选后的行数）     |
  | $NF       | 浏览记录的个数（切割后的列数） |

- 举例

  ```shell
  awk -F : '/^root/{print $1","$7}' passwd
  #匹配passwd文件中以root开头的行,以":"为分隔符,输出该行的第1、7列内容,并以","分隔
  
  awk -F : 'BEGIN{print "user, shell"} {print $1","$7} END{print "atguigu,/bin/lcx"}' passwd
  #对passwd文件的首行前添加"user, shell",以":"为分隔符,输出每行的第1、7列,在末尾添加"atguigu,/bin/lcx"
  #BEGIN:在所有数据读取之前执行
  #END:在所有数据读取之后执行
  
  awk -v i=1 -F: '{print $3+i}' passwd
  #将passwd中的每行内容以":"分隔,并输出每行第3列内容+1后的内容
  
  awk -F: '{print "filename:"  FILENAME ", linenumber:" NR  ",columns:" NF}' passwd
  #对于passwd的每一行,依次输出文件名、该行行号、该行以":"为分隔符分割的列数
  
  awk '/^$/{print NR}' sed.txt 
  #统计sed.txt中空行的所在的行号
  ```



### 10.4 sort

- 基本语法

  ```shell
  sort [选项] [文件]
  #sort不改变原文件内容
  ```

- 选项列表

  | 选项 | 功能                     |
  | ---- | ------------------------ |
  | -n   | 依照数值的大小排序       |
  | -r   | 以相反的顺序排序         |
  | -t   | 设置排序时所用的分隔字符 |
  | -k   | 指定需要排序的列         |

- 举例

  ```shell
  sort -t : -nrk 3  sort.sh
  #以":"为分隔符,以第3列的倒序对行排序
  ```



### 10.5 wc

- 基本语法

  ```shell
  wc [选项] [文档]
  ```

- 选项列表

  | 选项 | 功能             |
  | ---- | ---------------- |
  | -l   | 统计文件行数     |
  | -w   | 统计文件的单词数 |
  | -m   | 统计文件的字符数 |
  | -c   | 统计文件的字节数 |

